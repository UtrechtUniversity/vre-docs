<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>long-jobs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6020956a11f5c8c1e4b5ffdbaa316057.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../_styles/styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/research-cloud-intro.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/onboarding.html"> 
<span class="menu-text">Get started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/first-steps.html"> 
<span class="menu-text">First steps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/workspace-catalogue.html"> 
<span class="menu-text">Workspaces</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/manuals.html"> 
<span class="menu-text">Manuals</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/responsible-use.html"> 
<span class="menu-text">Tips</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/terms-of-use.html"> 
<span class="menu-text">Terms of use</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/privacy.html"> 
<span class="menu-text">Privacy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/glossary.html"> 
<span class="menu-text">Glossary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#running-long-jobs-on-your-research-cloud-workspace" id="toc-running-long-jobs-on-your-research-cloud-workspace" class="nav-link active" data-scroll-target="#running-long-jobs-on-your-research-cloud-workspace">Running long jobs on your Research Cloud workspace</a>
  <ul class="collapse">
  <li><a href="#when-is-this-relevant" id="toc-when-is-this-relevant" class="nav-link" data-scroll-target="#when-is-this-relevant">When is this relevant?</a></li>
  <li><a href="#saving-credits-and-resources-when-running-long-jobs" id="toc-saving-credits-and-resources-when-running-long-jobs" class="nav-link" data-scroll-target="#saving-credits-and-resources-when-running-long-jobs">Saving credits and resources when running long jobs</a></li>
  <li><a href="#how-to-run-jobs-as-background-processes" id="toc-how-to-run-jobs-as-background-processes" class="nav-link" data-scroll-target="#how-to-run-jobs-as-background-processes">How to run jobs as background processes</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#step-1-make-sure-you-are-in-a-terminal" id="toc-step-1-make-sure-you-are-in-a-terminal" class="nav-link" data-scroll-target="#step-1-make-sure-you-are-in-a-terminal">Step 1: Make sure you are in a terminal</a></li>
  <li><a href="#step-2-navigate-to-the-directory-where-your-script-is-located" id="toc-step-2-navigate-to-the-directory-where-your-script-is-located" class="nav-link" data-scroll-target="#step-2-navigate-to-the-directory-where-your-script-is-located">Step 2: Navigate to the directory where your script is located</a></li>
  <li><a href="#step-3-run-your-script-as-background-process" id="toc-step-3-run-your-script-as-background-process" class="nav-link" data-scroll-target="#step-3-run-your-script-as-background-process">Step 3: Run your script as background process</a></li>
  <li><a href="#terminating-the-process" id="toc-terminating-the-process" class="nav-link" data-scroll-target="#terminating-the-process">Terminating the process</a></li>
  <li><a href="#how-do-i-know-my-job-has-ended" id="toc-how-do-i-know-my-job-has-ended" class="nav-link" data-scroll-target="#how-do-i-know-my-job-has-ended">How do I know my job has ended?</a></li>
  <li><a href="#monitoring-progress" id="toc-monitoring-progress" class="nav-link" data-scroll-target="#monitoring-progress">Monitoring progress</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/UtrechtUniversity/vre-docs/edit/main/docs/manuals/long-jobs.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/UtrechtUniversity/vre-docs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/UtrechtUniversity/vre-docs/blob/main/docs/manuals/long-jobs.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="running-long-jobs-on-your-research-cloud-workspace" class="level1">
<h1>Running long jobs on your Research Cloud workspace</h1>
<section id="when-is-this-relevant" class="level2">
<h2 class="anchored" data-anchor-id="when-is-this-relevant">When is this relevant?</h2>
<p>Often it is advisable to run long jobs (e.g.&nbsp;long scripts or analyses that take hours or days to complete) as background processes. By running long jobs as background process, you make sure the jobs will not be interrupted when you (by accident) close the window with which you access your workspace or when your internet connection is interrupted. This can happen in the following cases:</p>
<ul>
<li>When you access your workspace via your web browser (Jupyter Notebooks, RStudio, Ubuntu Desktop, etc.)</li>
<li>When you access your workspace via SSH</li>
</ul>
<p>When you access your workspace via RDP (Remote Desktop), jobs will normally not be interupted by disconnecting. <a href="https://utrechtuniversity.github.io/vre-docs/docs/first-steps.html#getting-access-to-your-workspace">More info on access methods</a></p>
</section>
<section id="saving-credits-and-resources-when-running-long-jobs" class="level2">
<h2 class="anchored" data-anchor-id="saving-credits-and-resources-when-running-long-jobs">Saving credits and resources when running long jobs</h2>
<p>A problem you may run into when running long jobs on your workspace is that the workspace will keep running even after the job is complete. Because you might not know exactly how long your job will take, you may be unable to <a href="../../docs/responsible-use.html#pausing-or-deleting-workspaces">pause the workspace</a> manually immediately after the job is finished. This can potentially cost a lot of credits, and waste resources on the platform. <a href="../../docs/workspace-catalogue.html">UU-maintained Catalog Items</a> come with a custom <code>run_and_pause</code> script that will pause your workspace when your long-running process is finished. Read more about it <a href="#method-1-using-run_and_pause">below</a>.</p>
</section>
<section id="how-to-run-jobs-as-background-processes" class="level2">
<h2 class="anchored" data-anchor-id="how-to-run-jobs-as-background-processes">How to run jobs as background processes</h2>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<ul>
<li>You will need some basic linux command line skills to be able to run scripts as background processes. If you don’t have these skills, take some time to practice using sections 1, 2, 3 and 7 of this short <a href="https://swcarpentry.github.io/shell-novice">online course</a> before proceeding. You can practice in the terminal (see step 1).</li>
<li>Your script should be ‘standalone’; which means that you should be able to run your entire script in one go without providing additional input. For scripts, all figures and output data should be stored in files (e.g.&nbsp;<code>.png</code> images and/or <code>.csv</code> tables), for Jupyter notebooks this might be not necessary if the figures should be embedded in the notebook.</li>
</ul>
</section>
<section id="step-1-make-sure-you-are-in-a-terminal" class="level3">
<h3 class="anchored" data-anchor-id="step-1-make-sure-you-are-in-a-terminal">Step 1: Make sure you are in a terminal</h3>
<ul>
<li>In Jupyterhub (Jupyter Workspace in Research cloud): To open a new terminal, click the + button in the file browser and select the terminal in the new Launcher tab (<a href="https://jupyterlab.readthedocs.io/en/stable/user/terminal.html">find a short video here</a>).</li>
<li>In Rstudio (Rstudio workspace in Research cloud): In the bottom left panel, click the ‘terminal’ tab.</li>
<li>In an Ubuntu Desktop workspace, click ‘Applications’ in the top left corner and then ‘Terminal’</li>
</ul>
</section>
<section id="step-2-navigate-to-the-directory-where-your-script-is-located" class="level3">
<h3 class="anchored" data-anchor-id="step-2-navigate-to-the-directory-where-your-script-is-located">Step 2: Navigate to the directory where your script is located</h3>
<p>For example:</p>
<pre><code>cd data
cd &lt;your storage volume name&gt;
...</code></pre>
</section>
<section id="step-3-run-your-script-as-background-process" class="level3">
<h3 class="anchored" data-anchor-id="step-3-run-your-script-as-background-process">Step 3: Run your script as background process</h3>
<p>We outline two ways of running your long job as a background process:</p>
<ol type="1">
<li><a href="#method-1-using-run_and_pause">Using the UU-provided <code>run_and_pause</code> script.</a>
<ul>
<li>the main advantage of this method is that it will automatically <a href="../../docs/responsible-use.html#pausing-or-deleting-workspaces">pause your workspace</a> when the job is finished, thereby saving credits and resources.</li>
<li>the downsides are that the script is only available on <a href="../../docs/workspace-catalogue.html">UU-maintained Catalog Items</a>, and that it requires a ResearchCloud API token.</li>
</ul></li>
<li><a href="#method-2-using-nohup">Using the generic method <code>nohup</code>.</a></li>
</ol>
<section id="method-1-using-run_and_pause" class="level4">
<h4 class="anchored" data-anchor-id="method-1-using-run_and_pause">Method 1: using <code>run_and_pause</code></h4>
<p><em>Additional prerequisites</em>:</p>
<ul>
<li>a personal ResearchCloud API token. See <a href="https://servicedesk.surf.nl/wiki/spaces/WIKI/pages/117178402/SRC+API">here</a> for how to acquire one.
<ul>
<li><strong>NOTE: an API token is sensitive information. Treat it safely, just as you would treat a password!</strong></li>
</ul></li>
<li>a workspace that contains the <code>run_and_pause</code> script. You can check whether it is installed by just typing <code>run_and_pause</code> in your terminal. All <a href="../../docs/workspace-catalogue.html">UU-maintained catalog items</a> should have the script installed.</li>
</ul>
<p>To run your long job and automatically pause the workspace when it is finished, simply perform the following steps:</p>
<ol type="1">
<li>Run <code>run_and_pause "mycommand myarg1 myarg2"</code> in your terminal.
<ul>
<li>optionally, you can add the <code>-s</code> flag to run <code>run_and_pause</code> in <a href="#running-run_and_pause-in-silent-mode">silent mode</a>.</li>
</ul></li>
<li>The script will prompt you for your ResearchCloud API token. Enter it.</li>
<li>The script will create a log file to which all output of your script will be logged, and tell you where to find it.</li>
<li>Press any key to start running your command. The <code>run_and_pause</code> script will now exit, but your command wil keep running in the background.</li>
<li>When the job is finished, the workspace will be automatically paused!</li>
</ol>
<section id="inspecting-output" class="level5">
<h5 class="anchored" data-anchor-id="inspecting-output"><strong>Inspecting output</strong></h5>
<p>After the <code>run_and_pause</code> script exits (step 4), you can check your script’s output by inspecting the logfile. Logfiles will always be written to your home directory, and the script will tell you the exact location. For instance, <code>run_and_pause</code> might tell you the following:</p>
<pre><code>The command's output will be saved to /home/youruser/run_and_pause.abcd123.log`</code></pre>
<p>You can then use any text editor to inspect this logfile. To track live output while your command is running, you could use the following command: <code>tail -f /home/youruser/run_and_pause.abcd123.log</code></p>
<p><em>Note: the logfile will only contain output that is written to the default ‘standard output’ and ‘standard error’. If your script instead writes output to certain set locations, of course your results will be saved there!</em></p>
</section>
<section id="running-run_and_pause-in-silent-mode" class="level5">
<h5 class="anchored" data-anchor-id="running-run_and_pause-in-silent-mode"><strong>Running <code>run_and_pause</code> in silent mode</strong></h5>
<p>By default, <code>run_and_pause</code> will write some helpful messages to the logfile. For instance, after completion, the file <code>/home/youruser/run_and_pause.abcd123.log</code> might look as follows:</p>
<pre><code>Will run the following command, and pause the workspace when it exits:
echo "HELLO WORLD"
All output from the command will be captured below.
To interrupt this process, run:
kill 2605 &amp;&amp; pkill -P 2605
Command output starts below.
------
HELLO WORLD
------
Command exited with exit code: 0
Now pausing the workspace...</code></pre>
<p>If you want the logfile to only contain your command’s output, you can run <code>run_and_pause</code> in silent mode by adding the <code>-s</code> flag. So for instance: <code>run_and_pause -s mycommand myarg1 myarg2</code>. The info messages from <code>run_and_pause</code> will now be omitted from the log.</p>
</section>
</section>
<section id="method-2-using-nohup" class="level4">
<h4 class="anchored" data-anchor-id="method-2-using-nohup">Method 2: using <code>nohup</code></h4>
<p>More info about the use of <code>nohup</code> can be found <a href="https://www.howtogeek.com/804823/nohup-command-linux/#the-nohup-command">here</a>. For this usecase we combine <code>nohup</code> with an ampersand “&amp;” to run a background process the will continue even is the terminal window is closed. The process will only stop:</p>
<ul>
<li>If it has finished</li>
<li>If an error occurs</li>
<li>If the workspaces is paused or deleted</li>
</ul>
<p>If your script normally prints output to the terminal or console, this will now be written into a file <code>nohup.out</code> which will be created automatically when you run the script in the folder from where you run the script.</p>
<p>For R scripts:</p>
<pre><code>nohup Rscript your-rscript.R &amp;</code></pre>
<p>For Jupyter notebooks:</p>
<pre><code>nohup jupyter nbconvert --execute --to notebook --inplace your-notebook.ipynb &amp;</code></pre>
<p>After submitting this command you will see the following:</p>
<p><img src="../imgs/background.png" class="img-fluid"></p>
<p>You need to press Enter one more time to return to the command prompt. The number between square brackets is the job ID and the second number is the process ID.</p>
</section>
</section>
<section id="terminating-the-process" class="level3">
<h3 class="anchored" data-anchor-id="terminating-the-process">Terminating the process</h3>
<section id="terminating-a-command-run-via-nohup" class="level4">
<h4 class="anchored" data-anchor-id="terminating-a-command-run-via-nohup">Terminating a command run via <code>nohup</code></h4>
<p>Use the process ID to terminate the job, e.g.:</p>
<pre><code>kill 152233</code></pre>
<p>If you don’t know the process ID you can look it up by using a monitoring tool like <code>top</code> (<a href="https://www.howtogeek.com/668986/how-to-use-the-linux-top-command-and-understand-its-output/">more info</a>).</p>
</section>
<section id="terminating-a-command-run-with-run_and_pause" class="level4">
<h4 class="anchored" data-anchor-id="terminating-a-command-run-with-run_and_pause">Terminating a command run with <code>run_and_pause</code></h4>
<p>When you are using <code>run_and_pause</code> (see <a href="#method-1-using-run_and_pause">above</a>), you need to terminate two processes:</p>
<ol type="1">
<li>The process used by <code>run_and_pause</code> to pause the workspace after <code>yourcommand</code> exits</li>
<li>The process that is actually running <code>yourcommand</code></li>
</ol>
<p>If you only terminate the second process, the workspace will still be paused!</p>
<p>Fortunately, <code>run_and_pause</code> tells you exactly how to terminate both processes. It will tell you, for instance:</p>
<pre><code>Now running your command, and will pause the workspace afterwards!
To stop this process, and stop the workspace from pausing, run:
kill 1234 &amp;&amp; pkill -P 1234</code></pre>
<p>So to interrupt your command and stop the workspace from being paused, just run <code>kill 1234 &amp;&amp; pkill -P 1234</code>.</p>
<p><em>Explanation</em>: in the above example, <code>1234</code> is the so-called ‘process number’ of the command used to pause the workspace. <code>kill 1234</code> interrupts that process (ensuring the workspace is not paused), while <code>pkill -P 1234</code> interrupts all direct sub-processes of that command, ensuring that <code>yourcommand</code> is also stopped.</p>
<p><em>Note</em>: if <code>yourcommand</code> also spawns sub-processes, you may need to kill them by hand. Of course, you could also pause and resume the workspace to achieve the same result!</p>
</section>
</section>
<section id="how-do-i-know-my-job-has-ended" class="level3">
<h3 class="anchored" data-anchor-id="how-do-i-know-my-job-has-ended">How do I know my job has ended?</h3>
<p>There are several ways to find out if your job has ended:</p>
<p>When things go as planned, you can check if the expected output data has been generated. You can also use the <code>jobs</code> command to check the status of your background job. If the job is running, the output will look like this:</p>
<pre><code>[1]+  Running                 nohup Rscript test.R &amp;</code></pre>
<p>If the job has ended, there will be no output.</p>
</section>
<section id="monitoring-progress" class="level3">
<h3 class="anchored" data-anchor-id="monitoring-progress">Monitoring progress</h3>
<p>By adding print statements to your script, you allow monitoring of the progress of your script (it might be that some of the functions that you use already print output to the console/terminal by default). All output that you create with print statements will be written to the <code>nohup.out</code> file (see step 3). Use for example a print statement in a for loop to print the iteration number. Follow these links for more info:</p>
<ul>
<li><a href="https://www.r-bloggers.com/2021/09/r-print-output/">Print statements in R</a></li>
<li><a href="https://learnpython.com/blog/python-print/">Print statements in Python</a></li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/UtrechtUniversity\.github\.io\/vre-docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UtrechtUniversity/vre-docs/edit/main/docs/manuals/long-jobs.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/UtrechtUniversity/vre-docs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/UtrechtUniversity/vre-docs/blob/main/docs/manuals/long-jobs.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>